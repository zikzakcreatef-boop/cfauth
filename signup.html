<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°è¦ç™»éŒ² - CFèªè¨¼ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="style.css">
    <style>
        .success-icon { font-size: 64px; color: #28a745; margin-bottom: 20px; display: block; }
        .step-box { text-align: left; background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 20px 0; border: 1px solid #eee; }
        .step-title { font-weight: bold; margin-bottom: 12px; color: #333; font-size: 15px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        .step-item { display: flex; align-items: flex-start; margin-bottom: 10px; font-size: 14px; color: #555; }
        .step-num { background: #007bff; color: #fff; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; margin-right: 10px; flex-shrink: 0; }
    </style>
</head>
<body id="main-body">
    <div class="container">
        <div class="form-box">
            <div id="logo-container" style="margin-bottom: 20px;"></div>
            <h2><span id="system-name">CFèªè¨¼ã‚·ã‚¹ãƒ†ãƒ </span></h2>
            
            <div id="form-area">
                <p class="description">å¿…è¦äº‹é …ã‚’å…¥åŠ›ã—ã¦ç”³è«‹ã—ã¦ãã ã•ã„ã€‚</p>
                <div class="input-group">
                    <input type="text" id="name" placeholder="ãŠåå‰" required>
                </div>
                <div class="input-group">
                    <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required>
                </div>
                <div class="input-group">
                    <input type="password" id="password" placeholder="å¸Œæœ›ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required>
                </div>
                <button id="submitBtn" class="btn btn-primary" onclick="submitForm()">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆç”³è«‹</button>
            </div>

            <div id="success-area" style="display: none;">
                <span class="success-icon">ğŸ“©</span>
                <h3>ç”³è«‹ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸ</h3>
                <div class="step-box">
                    <div class="step-title">ä»Šå¾Œã®æµã‚Œ</div>
                    <div class="step-item">
                        <div class="step-num">1</div>
                        <div>å…¥åŠ›ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«èªè¨¼ãƒ¡ãƒ¼ãƒ«ãŒå±Šãã¾ã™ã€‚</div>
                    </div>
                    <div class="step-item">
                        <div class="step-num">2</div>
                        <div>ãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦èªè¨¼ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚</div>
                    </div>
                    <div class="step-item">
                        <div class="step-num">3</div>
                        <div>ç®¡ç†è€…ã®æ‰¿èªå¾Œã€ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</div>
                    </div>
                </div>
                <p style="font-size: 14px; color: #666;">â€»ãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„å ´åˆã¯ã€è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
                <a href="index.html" class="btn btn-secondary" style="display: block; margin-top: 20px; text-decoration: none;">ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸</a>
            </div>

            <div id="message" class="status-message" style="margin-top: 20px;"></div>
            
            <div class="footer-links" id="footer-links-area">
                <a href="index.html" class="back-link">ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹</a>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        // è¨­å®šã®åæ˜ 
        window.onload = function() {
            const cachedTitle = localStorage.getItem('cached_system_title');
            const cachedBg = localStorage.getItem('cached_bg_color');
            const cachedLogo = localStorage.getItem('cached_logo_url');
            if(cachedTitle) document.getElementById('system-name').innerText = cachedTitle;
            if(cachedBg) document.getElementById('main-body').style.backgroundColor = cachedBg;
            if(cachedLogo) document.getElementById('logo-container').innerHTML = `<img src="${cachedLogo}" style="max-width: 120px;">`;
        };

        async function submitForm() {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const msgDiv = document.getElementById('message');
            const btn = document.getElementById('submitBtn');

            if (!name || !email || !password) {
                msgDiv.style.color = "#d93025";
                msgDiv.innerText = "ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
                return;
            }

            btn.disabled = true;
            btn.innerText = "é€ä¿¡ä¸­...";

            try {
                // é€šä¿¡ã‚¨ãƒ©ãƒ¼ï¼ˆCORSï¼‰å›é¿ã®ãŸã‚ã®ä¿®æ­£ç‰ˆ fetch
                const response = await fetch(GAS_URL, {
                    method: "POST",
                    mode: "no-cors", // GASã¸ã®POSTã§ãƒ–ãƒ©ã‚¦ã‚¶ã‚¨ãƒ©ãƒ¼ã‚’é˜²ã
                    headers: {
                        "Content-Type": "text/plain;charset=utf-8"
                    },
                    body: JSON.stringify({
                        action: "signup",
                        apiKey: API_KEY,
                        userName: name,
                        userId: email,
                        password: password
                    })
                });

                // mode: "no-cors" ã®å ´åˆã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…å®¹ã‚’èª­ã¿å–ã‚Œãªã„ãŸã‚ã€
                // é€ä¿¡ã§ããŸã“ã¨è‡ªä½“ã‚’æˆåŠŸã¨ã—ã¦æ‰±ã†ã‹ã€
                // ã‚ã‚‹ã„ã¯é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã§è©¦è¡Œã—ã¦ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¡Œã†
                
                // ã“ã“ã§ã¯å†åº¦ã€æ¨™æº–çš„ãª fetch ã§æˆå¦ã‚’åˆ¤æ–­ï¼ˆGASã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ã‘å–ã‚‹ï¼‰
                const resCheck = await fetch(GAS_URL, {
                    method: "POST",
                    body: JSON.stringify({
                        action: "signup",
                        apiKey: API_KEY,
                        userName: name,
                        userId: email,
                        password: password
                    })
                });
                const res = await resCheck.json();

                if (res.success) {
                    document.getElementById('form-area').style.display = "none";
                    document.getElementById('footer-links-area').style.display = "none";
                    document.getElementById('success-area').style.display = "block";
                    msgDiv.innerText = "";
                } else {
                    msgDiv.style.color = "#d93025";
                    msgDiv.innerText = res.message;
                    btn.disabled = false;
                    btn.innerText = "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆç”³è«‹";
                }
            } catch (error) {
                console.error("Fetch Error:", error);
                msgDiv.style.color = "#d93025";
                msgDiv.innerText = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ã€‚GASã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
                btn.disabled = false;
                btn.innerText = "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆç”³è«‹";
            }
        }
    </script>
</body>
</html>