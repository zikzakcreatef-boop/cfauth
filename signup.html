<script>
    async function submitSignup() {
        const name = document.getElementById('userName').value;
        const email = document.getElementById('userId').value;
        const password = document.getElementById('password').value;
        const btn = document.getElementById('submitBtn');
        const msgDiv = document.getElementById('statusMsg');

        if (!name || !email || !password) {
            msgDiv.style.color = "#d93025";
            msgDiv.innerText = "全項目入力してください。";
            return;
        }

        btn.disabled = true;
        btn.innerText = "送信中...";

        try {
            // mode: "no-cors" は絶対に使わないこと。JSONレスポンスが読めなくなるため。
            const response = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({
                    action: "signup",
                    apiKey: API_KEY,
                    userName: name,
                    userId: email,
                    password: password
                })
            });
            const res = await response.json();

            if (res.success) {
                // 成功時は入力エリアを消して成功メッセージを表示
                document.getElementById('form-area').style.display = "none";
                document.getElementById('footer-links-area').style.display = "none";
                document.getElementById('success-area').style.display = "block";
                msgDiv.innerText = "";
            } else {
                msgDiv.style.color = "#d93025";
                msgDiv.innerText = res.message;
                btn.disabled = false;
                btn.innerText = "アカウント作成申請";
            }
        } catch (error) {
            console.error("Fetch error:", error);
            msgDiv.style.color = "#d93025";
            msgDiv.innerText = "通信エラーが発生しました。";
            btn.disabled = false;
            btn.innerText = "アカウント作成申請";
        }
    }
</script>