<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background: #f0f2f5; margin: 0; }
      .signup-card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 320px; text-align: center; }
      h3 { color: #333; margin-bottom: 1.5rem; }
      input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
      button { width: 100%; padding: 12px; background: #34a853; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; }
      button:disabled { background: #ccc; }
      .back-link { background: none; color: #4285f4; border: none; text-decoration: underline; cursor: pointer; font-size: 0.8rem; margin-top: 15px; display: block; width: 100%; }
      #message { margin-top: 15px; font-size: 0.85rem; min-height: 1.2rem; }
    </style>
  </head>
  <body>
    <div class="signup-card">
      <h3>Create Account</h3>
      <input type="text" id="userName" placeholder="Your Name" required>
      <input type="email" id="email" placeholder="Email Address" required>
      <input type="password" id="password" placeholder="Password" required>
      <button id="regBtn" onclick="register()">アカウント作成申請</button>
      <button class="back-link" onclick="location.href='index.html'">ログインに戻る</button>
      <div id="message"></div>
    </div>

    <script>
      const GAS_URL = "https://script.google.com/macros/s/AKfycbwwqEvQgapuJO8UXWBeHHOHq7GxavWxjhnyELAikMEYJu-1jLC_J2AzpNATDrV6uyTxIw/exec";
      const msgDiv = document.getElementById('message');
      const regBtn = document.getElementById('regBtn');

      async function register() {
        const name = document.getElementById('userName').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        if (!name || !email || !password) {
          msgDiv.style.color = "#d93025";
          msgDiv.innerText = "全部入力してください！";
          return;
        }

        regBtn.disabled = true;
        msgDiv.style.color = "#4285f4";
        msgDiv.innerText = "登録処理中...";

        try {
          const response = await fetch(GAS_URL, {
            method: "POST",
            body: JSON.stringify({
              action: "signup",
              userId: email, // GAS側の引数名に合わせてuserId
              password: password,
              name: name
            })
          });

          const res = await response.json();

          if (res.success) {
            msgDiv.style.color = "#34a853";
            msgDiv.innerText = "申請成功しました！";
            alert(name + " さん、申請成功しました！\n管理者が承認するまでお待ちください。");
            window.location.href = "index.html";
          } else {
            msgDiv.style.color = "#d93025";
            msgDiv.innerText = res.message;
            regBtn.disabled = false;
          }
        } catch (err) {
          msgDiv.innerText = "通信エラーが発生しました。";
          regBtn.disabled = false;
        }
      }
    </script>
  </body>
</html>