<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>パスワード再設定 - Auth System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h2>パスワード再設定</h2>
        <p>登録済みのメールアドレスを入力してください。</p>
        
        <form id="resetForm" name="password-reset" method="POST" data-netlify="true">
            <div class="input-group">
                <input type="email" name="email" id="email" placeholder="メールアドレス" required>
            </div>
            <button type="submit" id="submitBtn">再設定メールを送信</button>
            
            <p id="statusMsg" style="margin-top: 15px; font-weight: bold;"></p>
        </form>

        <div class="footer-links">
            <a href="/" class="back">ログイン画面に戻る</a>
        </div>
    </div>

    <script>
        const resetForm = document.getElementById('resetForm');
        const submitBtn = document.getElementById('submitBtn');
        const statusMsg = document.getElementById('statusMsg');

        resetForm.onsubmit = async (e) => {
            // デフォルトの送信（ページ遷移）を阻止
            e.preventDefault();

            // ボタンを無効化して二重送信を防止
            submitBtn.disabled = true;
            submitBtn.innerText = '送信中...';
            statusMsg.style.color = '#333';
            statusMsg.innerText = 'サーバーへ送信しています...';

            const formData = new FormData(resetForm);
            
            try {
                // Netlifyに非同期でフォームデータを送信
                const response = await fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(formData).toString(),
                });

                if (response.ok) {
                    statusMsg.style.color = 'green';
                    statusMsg.innerText = '送信完了！ログイン画面に戻ります。';
                    
                    // 3秒後にログイン画面へ強制リダイレクト
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 3000);
                } else {
                    throw new Error('送信エラー');
                }
            } catch (error) {
                statusMsg.style.color = 'red';
                statusMsg.innerText = 'エラーが発生しました。時間を置いてやり直してください。';
                submitBtn.disabled = false;
                submitBtn.innerText = '再設定メールを送信';
            }
        };
    </script>
</body>
</html>