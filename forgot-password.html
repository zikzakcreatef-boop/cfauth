<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>パスワード再設定 - CF認証システム</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="form-box">
            <h2>パスワードの再設定</h2>
            <p class="description">登録したメールアドレスを入力してください。再設定用のリンクをお送りします。</p>
            
            <form id="resetForm" name="password-reset" method="POST" data-netlify="true">
                <div class="input-group">
                    <input type="email" name="email" id="email" placeholder="メールアドレス" required>
                </div>
                
                <button type="submit" id="submitBtn" class="login-btn">送信する</button>
                
                <p id="statusMsg" class="status-message"></p>
            </form>

            <div class="footer-links">
                <a href="/" class="back-link">ログイン画面に戻る</a>
            </div>
        </div>
    </div>

    <script>
        const resetForm = document.getElementById('resetForm');
        const submitBtn = document.getElementById('submitBtn');
        const statusMsg = document.getElementById('statusMsg');

        resetForm.onsubmit = async (e) => {
            e.preventDefault();
            submitBtn.disabled = true;
            submitBtn.innerText = '送信中...';
            statusMsg.style.color = '#666';
            statusMsg.innerText = 'サーバーへ送信しています...';

            const formData = new FormData(resetForm);
            
            try {
                const response = await fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(formData).toString(),
                });

                if (response.ok) {
                    statusMsg.style.color = '#007bff';
                    statusMsg.innerText = '送信完了！ログイン画面に戻ります。';
                    setTimeout(() => { window.location.href = '/'; }, 3000);
                } else {
                    throw new Error('error');
                }
            } catch (error) {
                statusMsg.style.color = '#dc3545';
                statusMsg.innerText = 'エラーが発生しました。';
                submitBtn.disabled = false;
                submitBtn.innerText = '送信する';
            }
        };
    </script>
</body>
</html>